<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta Histórica</title>
    <!-- Estilos -->
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
    <!-- Incluye la última versión de la librería de Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
    <!-- Formulario de consulta histórica -->
    <form onsubmit="return obtenerYDibujarCoordenadasHistoricas()">
        <label for="inicio">Inicio:</label>
        <input type="text" id="inicio" name="inicio">

        <label for="fin">Fin:</label>
        <input type="text" id="fin" name="fin">

        <button type="submit">Consultar Historial</button>
    </form>

    <!-- Mapa -->
    <div id="map"></div>

    <!-- Incluye jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Incluye la última versión de la librería de Leaflet -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Código JavaScript para inicializar el mapa Leaflet
        var mymap = L.map('map').setView([10.99912735754, -74.81467299], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);

        // Función para obtener y trazar coordenadas históricas
        function obtenerYDibujarCoordenadasHistoricas() {
            var inicio = $("#inicio").val();
            var fin = $("#fin").val();
            
            // Realizar la consulta AJAX al servidor
            $.ajax({
                url: '/consulta_historica',
                type: 'POST',
                data: {inicio: inicio, fin: fin},
                success: function(data) {
                    // Procesar las coordenadas recibidas y trazarlas en el mapa
                    var coordenadas = data.coordenadas;
                    var historialCoords = [];
                    for (var i = 0; i < coordenadas.length; i++) {
                        var latitud = coordenadas[i].latitud;
                        var longitud = coordenadas[i].longitud;
                        historialCoords.push([latitud, longitud]);
                        L.marker([latitud, longitud]).addTo(mymap);
                    }
                    // Trazar ruta en el mapa
                    var polyline = L.polyline(historialCoords, {color: 'red'}).addTo(mymap);
                    // Ajustar el mapa para mostrar todas las coordenadas
                    mymap.fitBounds(polyline.getBounds());
                },
                error: function(error) {
                    alert("Hubo un error al obtener las coordenadas históricas.");
                    console.error(error);
                }
            });

            // Devolver false para evitar que el formulario se envíe y la página se recargue
            return false;
        }
    </script>
</body>
</html>

