<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta Histórica</title>
    <!-- Estilos -->
    <style>
        /* Estilos omitidos por brevedad */
    </style>
    <!-- Incluye jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Incluye jQuery UI -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>
<body>
    <!-- Encabezado dentro de un cuadro con bordes cuadrados -->
    <div class="header-container">
        <header>
            <h1>Consulta Histórica</h1>
            <p>Visualización de coordenadas históricas del vehículo.</p>
        </header>
    </div>

    <!-- Formulario de consulta histórica -->
    <form class="consulta-form" onsubmit="return obtenerCoordenadasHistoricas()">
        <label for="inicio">Inicio:</label>
        <input type="text" id="inicio" name="inicio">

        <label for="fin">Fin:</label>
        <input type="text" id="fin" name="fin">

        <button type="submit">Consultar Historial</button>
    </form>

    <!-- Mapa -->
    <div id="map-container">
        <div id="map"></div>
    </div>

    <form action="/tiempo_real">
        <button type="submit" class="btn-tiempo">Ir a Tiempo real</button>
    </form>

    <!-- Incluye la última versión de la librería de Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Incluye la biblioteca de Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
    <script>
        // Código JavaScript para inicializar el mapa Leaflet
        var mymap = L.map('map').setView([10.99912735754, -74.81467299], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);
    
        // Conexión con el servidor Flask usando Socket.IO
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        // Función para obtener coordenadas históricas
        function obtenerCoordenadasHistoricas() {
            var inicio = $("#inicio").val();
            var fin = $("#fin").val();
            
            // Emitir un evento al servidor con los valores de inicio y fin
            socket.emit('consulta_historica', { inicio: inicio, fin: fin });

            // Devolver false para evitar que el formulario se envíe y la página se recargue
            return false;
        }

        // Escuchar el evento 'update_historical_coords' del servidor y trazar la ruta en el mapa
        socket.on('update_historical_coords', function(data) {
            var coordenadas = data.coordenadas;
            var historialCoords = [];
            for (var i = 0; i < coordenadas.length; i++) {
                var latitud = coordenadas[i].latitud;
                var longitud = coordenadas[i].longitud;
                historialCoords.push([latitud, longitud]);
            }
            // Trazar ruta en el mapa
            var ruta = L.polyline(historialCoords, {color: 'red'}).addTo(mymap);
            // Ajustar el mapa para mostrar la ruta
            if (historialCoords.length > 0) {
                mymap.fitBounds(ruta.getBounds());
            }
        });
    </script>
</body>
</html>


